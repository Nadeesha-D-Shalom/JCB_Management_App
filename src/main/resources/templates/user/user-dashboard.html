<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Dashboard - JCB Management</title>
    <meta charset="UTF-8"/>
    <style>
        body { font-family: "Segoe UI", sans-serif; background: #f9f9f9; margin: 0; color: #222; }
        header { background: black; color: #FFD700; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
        nav { background: #FFD700; display: flex; justify-content: center; }
        nav a {
            color: black; padding: 14px 25px; text-decoration: none; font-weight: 600;
        }
        nav a:hover { background: black; color: white; }
        .content { padding: 20px; }

        h2 { color: #333; border-left: 6px solid #FFD700; padding-left: 10px; }

        table { border-collapse: collapse; width: 100%; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
        table th { background: #FFD700; color: black; padding: 10px; text-align: left; }
        table td { padding: 10px; border-bottom: 1px solid #eee; }
        button, select, input {
            padding: 8px 10px; border-radius: 5px; border: 1px solid #ccc; margin: 5px;
        }
        button { background: #FFD700; color: black; font-weight: bold; cursor: pointer; }
        button:hover { background: black; color: #FFD700; }
        .delete { color: red; font-weight: bold; }
    </style>
</head>
<body>
<header>JCB Management System — User Dashboard</header>

<nav>
    <a href="#" onclick="showTab('projects')">Projects</a>
    <a href="#" onclick="showTab('machines')">Machines</a>
    <a href="#" onclick="showTab('bookings')">Bookings</a>
</nav>

<div class="content">
    <!-- PROJECTS -->
    <div id="projects" class="tab">
        <h2>Available Projects</h2>
        <table>
            <tr><th>ID</th><th>Name</th><th>Description</th><th>Status</th></tr>
            <tr th:each="p : ${projects}">
                <td th:text="${p.id}"></td>
                <td th:text="${p.name}"></td>
                <td th:text="${p.description}"></td>
                <td th:text="${p.status}"></td>
            </tr>
        </table>
    </div>

    <!-- MACHINES -->
    <div id="machines" class="tab" style="display:none;">
        <h2>Available Machines</h2>
        <table>
            <tr><th>ID</th><th>Name</th><th>Type</th><th>Availability</th></tr>
            <tr th:each="m : ${machines}">
                <td th:text="${m.id}"></td>
                <td th:text="${m.name}"></td>
                <td th:text="${m.type}"></td>
                <td th:text="${m.availability ? 'Available' : 'Booked'}"></td>
            </tr>
        </table>
    </div>

    <!-- BOOKINGS -->
    <div id="bookings" class="tab" style="display:none;">
        <h2>Book a JCB</h2>
        <form th:action="@{/user/book}" th:object="${booking}" method="post">
            <label>Project:</label>
            <select th:field="*{project}">
                <option th:each="p : ${projects}" th:value="${p.id}" th:text="${p.name}"></option>
            </select>

            <label>Machine:</label>
            <select th:field="*{machine}">
                <option th:each="m : ${machines}" th:value="${m.id}" th:text="${m.name}"></option>
            </select>

            <label>Start Date:</label>
            <input type="date" th:field="*{startDate}" min="{{today}}"/>

            <label>End Date:</label>
            <input type="date" th:field="*{endDate}" min="{{today}}"/>

            <button type="submit">Book JCB</button>
        </form>

        <h2>Existing Bookings</h2>
        <table>
            <tr><th>ID</th><th>Project</th><th>Machine</th><th>Start</th><th>End</th><th>Status</th><th>Action</th></tr>
            <tr th:each="b : ${bookings}">
                <td th:text="${b.id}"></td>
                <td th:text="${b.project.name}"></td>
                <td th:text="${b.machine.name}"></td>
                <td th:text="${b.startDate}"></td>
                <td th:text="${b.endDate}"></td>
                <td th:text="${b.confirmed ? 'Confirmed' : 'Pending'}"></td>
                <td>
                    <a th:if="${!b.confirmed}" th:href="@{'/user/deleteBooking/' + ${b.id}}" class="delete">Delete</a>
                    <span th:if="${b.confirmed}">—</span>
                </td>
            </tr>
        </table>
    </div>
</div>

<script>
    function showTab(tabId) {
        document.querySelectorAll(".tab").forEach(t => t.style.display = "none");
        document.getElementById(tabId).style.display = "block";
    }

    document.addEventListener("DOMContentLoaded", () => showTab("projects"));
</script>
</body>
</html>
